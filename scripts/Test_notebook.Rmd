---
title: "R Notebook"
output: html_notebook
---


All poops so far

```{r}
ggplot(poops_only, aes(x = datetime, fill = participant))+
  geom_histogram(bins = 50)+
  scale_y_continuous(expand = c(0,0))+
  ggtitle("All poops")+
  theme_bw()
```

Poop race

```{r}
plot_df = poops_only %>% group_by(participant, .drop = F) %>% 
   arrange(datetime) %>% 
   mutate(count = row_number())

# add present cummulative total
cum_df = poops_only %>% group_by(participant, .drop = F) %>% 
   count()
cum_df$datetime = now()
colnames(cum_df)[2] = "count"

# add zero time
zero_df = poops_only %>% group_by(participant, .drop = F) %>% 
   count()
zero_df$datetime = dmy_hm("15/12/23, 10:00")
colnames(zero_df)[2] = "count"
zero_df$count = 0

plot_df = rbind(zero_df[,c(3,1,2)], plot_df[,c(1,4,6)], cum_df[,c(3,1,2)])

# end labels
lab_df = cum_df[,c(3,1,2)]

ggplot(plot_df, aes(x = datetime, y=count, color=participant))+
  geom_line(linewidth = 1)+
  geom_point(size = 2)+
  ggrepel::geom_text_repel(data = lab_df, mapping = aes(x = datetime, y=count, 
                                                        color=participant, label = participant), 
                           show.legend = F, fontface = "bold")+
  scale_y_continuous(limits = c(0, max(plot_df$count)+1))+
  ggtitle("Poop race")+
  theme_bw()+
  theme(legend.position = "none")

```

Poop times

```{r}
ggplot(poops_only, aes(x = time, fill = participant))+
  geom_histogram(bins = 60)+
  coord_polar(start = 0.05)+
  scale_x_time()+
  scale_y_continuous(expand = c(0,0))+
  ggtitle("Poop times")+
  theme_bw()
```

Poop times per participant

```{r}
ggplot(poops_only, aes(x = time, colour = participant))+
  facet_wrap(~participant)+
  geom_density(linewidth = 1.2, n = 512)+
  scale_x_time()+
  ggtitle("Poop times per participant")+
  theme_bw()
```

Shittiest day

```{r}
ggplot(poops_only, aes(x = date, fill = participant))+
  geom_histogram()+
  ggtitle("Shittiest day")+
  scale_y_continuous(expand = c(0,0), limits = c(0, 18))+
  theme_bw()
```

Shit leaderboard

```{r}
plot_df = as.data.frame(sort(table(poops_only$participant)))

ggplot(plot_df, aes(x = Freq, y = Var1))+
  geom_col(width = 0.1, just = 0.5)+
  emoGG::geom_emoji(emoji = "1f4a9")+
  scale_x_continuous(limits = c(0, max(plot_df$Freq)+max(plot_df$Freq)/10), 
                     expand = c(0,0))+
  labs(x = "Total", y = "Participant")+
  ggtitle("Shit leaderboard")+
  theme_classic()+
  theme(axis.text = element_text(size = 10, colour = "black"))
```

Longest time between poops (for each participant)

```{r}
largest_diff = poops_only %>% 
  group_by(participant) %>%
  filter(n() > 1) %>%
  mutate(difft = datetime - lag(datetime)) %>%
  slice(which.max(difft))

largest_diff$participant = factor(largest_diff$participant,
                                  levels = largest_diff$participant[order(largest_diff$difft)])
largest_diff$difft = lubridate::as.duration(largest_diff$difft)

ggplot(largest_diff, aes(x = difft, y = participant))+
  geom_col(width = 0.1, just = 0.5, fill = "green")+
  emoGG::geom_emoji(emoji = "1f922")+
  scale_x_time(limits = c(0, max(largest_diff$difft)+max(largest_diff$difft)/10), 
                     expand = c(0,0))+
  labs(x = "Longest hiatus", y = "Participant")+
  ggtitle("People holding their shit the longest")+
  theme_classic()+
  theme(axis.text = element_text(size = 10, colour = "black"))
```


